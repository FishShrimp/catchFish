{"version":3,"sources":["assets/scripts/mainGame/GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Fish from \"./Fish\";\nimport {MyEvent, FishType} from \"../Interface\";\nimport Utils from \"../Utils\";\nimport Bullet from \"./Bullet\";\nimport MyGlobal from \"../MyGlobal\";\nimport CoinUp from \"./CoinUp\";\nimport Gold from \"./Gold\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n\n    // 鱼的预制体\n    @property(cc.Prefab)\n    fishPrefab: cc.Prefab = null;\n\n    // 炮弹预制体\n    @property(cc.Prefab)\n    bulletPrefab: cc.Prefab = null;\n\n    // 分值的预制体\n    @property(cc.Prefab)\n    coinUpPrefab: cc.Prefab = null;\n\n    // 鱼网预制体\n    @property(cc.Prefab)\n    netPrefab: cc.Prefab = null;\n\n    //炮弹图集\n    @property(cc.SpriteAtlas)\n    weaponAtlas: cc.SpriteAtlas = null;\n\n    // 鱼游动的层\n    @property(cc.Node)\n    fishLayer: cc.Node = null;\n\n    // 炮台节点\n    @property(cc.Node)\n    weapon: cc.Node = null;\n\n    // 鱼的图集\n    @property(cc.SpriteAtlas)\n    fishAtlas: cc.SpriteAtlas = null;\n\n    // 金币的预制体\n    @property(cc.Prefab)\n    goldPrefab: cc.Prefab = null;\n\n    // 当前拥有多少金币\n    @property(cc.Node)\n    numControlNode: cc.Node = null;\n\n\n    // 鱼的对象池\n    public fishPool: cc.NodePool = new cc.NodePool();\n\n    // 炮弹的对象池\n    public bulletPool: cc.NodePool = new cc.NodePool();\n\n    // 鱼网的对象池\n    public netPool: cc.NodePool = new cc.NodePool();\n\n    // 分数的对象池\n    public coinUpPool: cc.NodePool = new cc.NodePool();\n\n    // 金币对象池\n    public goldPool: cc.NodePool = new cc.NodePool()\n\n\n    protected onLoad(): void {\n        // 初始化数据\n        MyGlobal.init();\n\n        const manager: cc.CollisionManager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        // manager.enabledDebugDraw = true;\n\n        // 把当前管理类放到全局的\n        MyGlobal.GameManager = this;\n\n        this.createFish();\n        this.schedule(this.createFish, 2);\n\n        // 监听触摸层传过来的时间，附带角度\n        cc.director.on(MyEvent.TOUCHEND_SHOOT, this.fireBullet, this);\n    }\n\n\n    /**\n     * 发射炮弹\n     * @param angle 炮弹的角度\n     */\n    public fireBullet(angle): void {\n        MyGlobal.NumControl.setGoldNum(MyGlobal.hasGold -= MyGlobal.weaponLevel);\n        const bullet: cc.Node = Utils.getPoolNode(this.bulletPool, this.bulletPrefab);\n        bullet.parent = this.fishLayer;\n        bullet.getComponent(Bullet).init(angle);\n    }\n\n    // 创建鱼\n    public createFish(): void {\n        let fishCount: number = 5;\n        let fishNode: cc.Node = null;\n        for (let i = 0; i < fishCount; i++) {\n            fishNode = Utils.getPoolNode(this.fishPool, this.fishPrefab);\n            fishNode.parent = this.fishLayer;\n            const x = -Math.random() * 150 - this.node.width / 2 - 100;\n            const y = Math.random() * 500 - 250;\n            const fishType = Utils.fishType[Math.floor(Math.random() * Utils.fishType.length)];\n            fishNode.getComponent(Fish).init(x, y, fishType);\n        }\n    }\n\n    // 创建获得的分数值\n    public createCoinUp(pos: cc.Vec2, fishType: FishType): void {\n        const coinUp: cc.Node = Utils.getPoolNode(this.coinUpPool, this.coinUpPrefab);\n        coinUp.parent = this.fishLayer;\n        coinUp.getComponent(CoinUp).init(pos, fishType);\n    }\n\n    // 创建金币\n    public createGold(pos: cc.Vec2): void {\n        const gold: cc.Node = Utils.getPoolNode(this.goldPool, this.goldPrefab);\n        gold.parent = this.fishLayer;\n        gold.getComponent(Gold).init(pos,cc.v2(-300,-270));\n    }\n\n    public testGameOver(): void {\n        if (Utils.testGameOver()) {\n            this.scheduleOnce(e => {\n                // this.GameOverNode.active = true;\n                cc.director.loadScene('gameOver');\n            }, 0.5);\n        }\n    }\n\n}\n"]}